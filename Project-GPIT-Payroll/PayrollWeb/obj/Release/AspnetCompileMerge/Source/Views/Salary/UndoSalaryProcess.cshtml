@using System.Diagnostics.Eventing.Reader
@using PayrollWeb.Models
@using PayrollWeb.ViewModels
@model PayrollWeb.ViewModels.SalaryProcessModel

@{
    ViewBag.Title = "UndoSalaryProcess";
    Layout = "~/Views/Shared/_LayoutDetailsPage.cshtml";
}

@section PageBanner
{
    Rollback Bonus Process
}

<br style="clear: both;"/>
    @{
        if (TempData.ContainsKey("msg"))
        {
            var res = (OperationResult)TempData["msg"];
            if (res.IsSuccessful)
            {
                <div id="notifyUser" class="alert alert-success">
			    <button data-dismiss="alert" class="close" type="button">×</button>
			    <div>@res.Message </div>
                </div>    
            }
            else
            {
                <div id="notifyUser" class="alert alert-error">
			    <button data-dismiss="alert" class="close" type="button">×</button>
			    <div>@res.Message </div>
                </div> 
            }
        }
    }
<fieldset id="bd">
    @using (@Html.BeginForm("UndoSalaryProcess", "Salary", FormMethod.Post, new { @class = "form-inline" }))
    {
        <div class="row-fluid" style="margin: 10px;">
            <div class="span3">
                Select Process Year
            </div>
            <div class="span8">
                @Html.DropDownListFor(m=>m.Year, new SelectList(@ViewBag.Years), "---Select Year---")
                @Html.ValidationMessageFor(m=>m.Year)
            </div>
        </div>
        <div class="row-fluid"  style="margin: 10px;">
            <div class="span3">
                Select Process Month
            </div>
            <div class="span8">
                @Html.DropDownListFor(m=>m.Month, new SelectList(@ViewBag.Months,"Value","Key"), "---Select Month---") 
                 @Html.ValidationMessageFor(m=>m.Month)
            </div>
        </div>
        <div class="row-fluid"  style="margin: 10px;">
            <div class="span3">@Html.LabelFor(model=> model.SalaryProcessDate)</div>
            <div class="span8">
                @Html.EditorFor(model => model.SalaryProcessDate)<br />
                @Html.ValidationMessageFor(model => model.SalaryProcessDate)
            </div>
        </div>
        <div class="row-fluid"  style="margin: 10px;">
            <div class="span3">@Html.LabelFor(model=> model.SalaryPaymentDate)</div>
            <div class="span8">
                @Html.EditorFor(model => model.SalaryPaymentDate)<br />
                @Html.ValidationMessageFor(model => model.SalaryPaymentDate)
            </div>
        </div>
        
        <div class="row-fluid"  style="margin: 10px;">
            <div class="span5"></div>
            <div class="span6">
                <i id="prel" style="display: none;"><img src="~/Content/pleasewait.gif"/></i>
                <button id="btnProcess" type="button" class="btn btn-primary" onclick = "UndoSalary(this); return false;">Process</button>
            </div>
        </div>
        <br />
    }

</fieldset>

<div id="prcsSalary" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-body">
    <p>Are you sure you want to rollback salary?</p>
    </div>
    <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button id="btnPrcsBonus" class="btn btn-primary">Rollback</button>
    </div>
</div>

@section PageSpecificJs
{
    <script type="text/javascript" src="~/Scripts/bootstrap-datepicker.js"></script>
    <script type="text/javascript">
        $('#SalaryProcessDate,#SalaryPaymentDate').datepicker();
    </script>

    <script type="text/javascript">
        function UndoSalary(el) {
            $('#prcsSalary').modal('show');
            $('#btnPrcsBonus').click(function () {
                $('#prcsSalary').modal('hide');
                var test = $(el).attr('href');
                document.forms[0].submit();
            });
        }

        function ShowBusy() {
            $('#prel').show();
            $('#btnProcess').text('Processing. Please wait...');
            $('#btnProcess').attr("disabled", "disabled");
        }
        function HideBusy() {
            $('#prel').hide();
            $('#btnProcess').text('Process');
            $('#btnProcess').removeAttr("disabled");
        }

    </script>

}

